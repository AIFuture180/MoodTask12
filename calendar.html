<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MoodTask Dashboard - Track your mood trends over time with personalized insights.">
    <meta name="keywords" content="MoodTask, mental health, mood tracker, emotional well-being, stress relief">
    <meta name="robots" content="index, follow">
    <meta name="author" content="MoodTask">
    <title>MoodTask - Dashboard</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            color: #333;
            transition: background-color 0.3s ease;
        }
        .nav-bar {
            background-color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            max-width: 1400px;
            margin: 0 auto;
            left: 0;
            right: 0;
            height: 60px;
            backdrop-filter: blur(5px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-bar .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #4A90E2;
        }
        .nav-bar .nav-links {
            display: flex;
            align-items: center;
            gap: 18px;
            padding-left: 30px;
            padding-right: 20px;
        }
        .nav-bar a {
            padding: 10px 15px;
            text-decoration: none;
            color: #2C3E50;
            font-weight: 400;
            transition: color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            border-radius: 5px;
        }
        .nav-bar a:hover {
            background-color: #f0f0f0;
            color: #2C3E50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .nav-bar a.active {
            background-color: #4A90E2;
            color: white;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .hamburger {
            display: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #2C3E50;
        }
        .main-content {
            transition: opacity 0.5s ease;
            padding-top: 60px;
        }
        .main-content.fade-out {
            opacity: 0;
        }
        .main-content.fade-in {
            opacity: 1;
        }
        .hero {
            background: linear-gradient(135deg, #4A90E2, #2C3E50);
            color: white;
            padding: 60px 20px;
            text-align: center;
            position: relative;
        }
        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        .hero p {
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .tracking-grid {
            margin-top: 30px;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .tracking-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .tracking-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .tracking-card i {
            font-size: 1.8em;
            color: #4A90E2;
            margin-bottom: 10px;
        }
        .tracking-card h3 {
            font-size: 1.2em;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 10px;
        }
        .tracking-card p {
            font-size: 1em;
            color: #555;
            margin: 0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .modal-content h3 {
            font-size: 1.5em;
            color: #2C3E50;
            margin-bottom: 15px;
        }
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        .modal-content button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .modal-content .save-btn {
            background-color: #4A90E2;
            color: white;
        }
        .modal-content .save-btn:hover {
            background-color: #2C3E50;
        }
        .modal-content .cancel-btn {
            background-color: #ccc;
            color: #333;
        }
        .modal-content .cancel-btn:hover {
            background-color: #bbb;
        }
        .modal-content .affiliate-link {
            display: block;
            margin-top: 15px;
            color: #4A90E2;
            text-decoration: none;
            font-size: 0.9em;
        }
        .modal-content .recommendation {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
        .graph-container {
            margin-top: 30px;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        .graph-controls {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .graph-controls select {
            padding: 5px 10px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        canvas {
            max-width: 100%;
            height: auto;
            min-height: 300px;
        }
        .mood-summary {
            background-color: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 0 auto 30px;
            text-align: left;
            max-width: 600px;
        }
        .mood-summary .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .mood-summary .header h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 5px;
        }
        .mood-summary .header p {
            font-size: 1em;
            color: #555;
            font-style: italic;
        }
        .mood-summary .trend {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .mood-summary .trend:hover {
            background: #f5f5f5;
        }
        .mood-summary .trend i {
            font-size: 1.5em;
            color: #4A90E2;
        }
        .mood-summary .trend div {
            flex: 1;
        }
        .mood-summary .trend h4 {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        .mood-summary .trend p {
            font-size: 0.95em;
            color: #555;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .mood-summary .trend .insight {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            background: #f0f0f0;
            padding: 10px;
            border-left: 3px solid #4A90E2;
            border-radius: 5px;
            line-height: 1.5;
        }
        .content-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .welcome-guide {
            flex: 1;
            max-width: 600px;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px auto;
            text-align: left;
        }
        .welcome-guide h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 15px;
        }
        .welcome-guide h3 {
            font-size: 1.3em;
            font-weight: 500;
            color: #4A90E2;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .welcome-guide p {
            font-size: 1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
        }
        .welcome-guide a {
            color: #4A90E2;
            text-decoration: none;
        }
        .welcome-guide a:hover {
            text-decoration: underline;
        }
        .footer {
            background-color: #333;
            color: white;
            padding: 40px 20px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            text-align: left;
        }
        .footer h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .footer a {
            color: #D6D1F5;
            text-decoration: none;
            display: block;
            margin: 5px 0;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .footer .affiliate-note {
            font-size: 0.8em;
            color: #aaa;
            margin-top: 20px;
            text-align: center;
            width: 100%;
        }
        .footer .connect a {
            padding: 10px 20px;
            margin: 5px 0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }
        .footer .connect .coffee {
            background-color: #FFC107;
            color: #333;
        }
        .footer .connect .therapy {
            background-color: #4A90E2;
            color: white;
        }
        .footer .connect .mindfulness {
            background-color: #6BCB77;
            color: white;
        }
        @media (max-width: 600px) {
            .nav-bar {
                height: 50px;
                padding: 5px 10px;
                justify-content: space-between;
                align-items: center;
            }
            .nav-bar .logo {
                font-size: 1.2em;
            }
            .nav-bar .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 50px;
                left: 0;
                width: 100%;
                background-color: #fff;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                padding: 10px 0;
            }
            .nav-bar .nav-links.active {
                display: flex;
            }
            .nav-bar a {
                padding: 10px;
                width: 100%;
                text-align: center;
                box-sizing: border-box;
            }
            .hamburger {
                display: block;
                margin-right: 10px;
            }
            .main-content {
                padding-top: 60px;
            }
            .hero {
                padding: 40px 15px;
            }
            .hero h1 {
                font-size: 1.8em;
            }
            .hero p {
                font-size: 1em;
            }
            .tracking-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .tracking-card {
                padding: 15px;
            }
            .modal-content {
                width: 90%;
                padding: 15px;
            }
            .modal-content h3 {
                font-size: 1.3em;
            }
            .modal-content input, .modal-content select {
                padding: 8px;
                font-size: 0.9em;
            }
            .modal-content button {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            .graph-container {
                padding: 15px;
            }
            .graph-controls {
                flex-direction: column;
                align-items: center;
            }
            .graph-controls select {
                width: 100%;
                margin-bottom: 10px;
            }
            canvas {
                height: 300px;
            }
            .mood-summary {
                margin: 20px 10px;
                max-width: 100%;
                padding: 20px;
            }
            .mood-summary .header h2 {
                font-size: 1.5em;
            }
            .mood-summary .header p {
                font-size: 0.95em;
            }
            .mood-summary .trend h4 {
                font-size: 1.1em;
            }
            .mood-summary .trend p {
                font-size: 0.9em;
            }
            .content-wrapper {
                flex-direction: column;
                padding: 0 10px;
            }
            .welcome-guide {
                margin: 20px auto;
                max-width: 100%;
                padding: 20px;
            }
            .welcome-guide h2 {
                font-size: 1.5em;
            }
            .welcome-guide h3 {
                font-size: 1.2em;
            }
            .welcome-guide p {
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <div class="logo">MoodTask</div>
        <div class="hamburger" id="hamburger">
            <i class="fas fa-bars"></i>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="index.html">Home</a>
            <a href="calendar.html" class="active">Dashboard</a>
            <a href="activities.html">Activities</a>
            <a href="music.html">Mood Music</a>
            <a href="blog.html">Blog</a>
            <a href="privacy.html">Privacy Policy</a>
            <a href="terms.html">Terms of Use</a>
        </div>
    </div>
    <div class="main-content fade-in">
        <div class="hero">
            <h1>Your Mood Dashboard</h1>
            <p>Track your emotional journey and discover science-backed insights.</p>
            <div class="tracking-grid">
                <div class="tracking-card">
                    <i class="fas fa-headphones"></i>
                    <h3>Last Mood Music</h3>
                    <p id="lastMusic">Not listened yet.</p>
                </div>
                <div class="tracking-card">
                    <i class="fas fa-check"></i>
                    <h3>First Activity</h3>
                    <p id="firstActivity">None today.</p>
                </div>
                <div class="tracking-card" onclick="openModal('sleepModal')">
                    <i class="fas fa-bed"></i>
                    <h3>Sleep Duration</h3>
                    <p id="sleepDuration">Not logged.</p>
                </div>
                <div class="tracking-card" onclick="openModal('waterModal')">
                    <i class="fas fa-tint"></i>
                    <h3>Water Intake</h3>
                    <p id="waterIntake">0 oz (0 ml)</p>
                </div>
                <div class="tracking-card" onclick="openModal('exerciseModal')">
                    <i class="fas fa-running"></i>
                    <h3>Exercise</h3>
                    <p id="exerciseDetails">Not logged.</p>
                    <p id="exerciseDays" style="font-size: 0.8em; color: #777;">Days exercised: 0</p>
                </div>
            </div>
            <div class="graph-container">
                <div class="graph-controls">
                    <label for="metricSelect">Metric: </label>
                    <select id="metricSelect" onchange="drawGraph()">
                        <option value="sleep">Sleep</option>
                        <option value="water">Water</option>
                        <option value="exercise">Exercise</option>
                    </select>
                    <label for="periodSelect">View Period: </label>
                    <select id="periodSelect" onchange="drawGraph()">
                        <option value="7">Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="week">Current Week</option>
                        <option value="month">Current Month</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
                <canvas id="progressGraph" width="800" height="400"></canvas>
            </div>
            <div class="mood-summary" id="moodSummary">
                <div class="header">
                    <h2>Your Mood Insights</h2>
                    <p>Science-Backed Analysis of Your Emotional Trends</p>
                </div>
                <div class="trend" id="frequentMood">
                    <i class="fas fa-chart-pie"></i>
                    <div>
                        <h4>Most Frequent Mood</h4>
                        <p id="frequentMoodText">Loading...</p>
                        <div class="insight" id="frequentMoodInsight">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-wrapper">
            <div class="welcome-guide">
                <h2>Welcome to Your Mood Dashboard</h2>
                <p>The MoodTask Dashboard is your personal hub for tracking and understanding your emotional well-being over time. Designed to help you gain insights into your mood patterns, this page lets you see how you’ve been feeling, what activities or music you’ve tried, and how your habits evolve day by day. By keeping track of your moods, activities, sleep, hydration, and exercise, you can identify trends, discover what works best for you, and take proactive steps to improve your mental health.</p>
                
                <h3>Why Track Your Habits?</h3>
                <p>Tracking your daily habits helps you become more aware of their impact on your emotional well-being. For example, you might notice that listening to uplifting music or completing a gratitude exercise boosts your mood, while good sleep or hydration reduces tiredness. This awareness empowers you to make informed decisions about your wellness, supported by science-backed insights from experts like Dr. Andrew Huberman and Dr. Matt Walker.</p>
                
                <h3>How to Use This Dashboard</h3>
                <p>Start by selecting a mood each day on the <a href="index.html">Home</a> page, and log your music, activities, sleep, water intake, and exercise here or on the <a href="activities.html">Activities</a> page. These will appear in your dashboard and graph above. Check the Mood Insights section to understand your most frequent mood. Future features will include filtering your history and exporting data as a CSV file!</p>
                
                <h3>Explore More Features</h3>
                <p>Dive deeper into your emotional journey by exploring our <a href="blog.html">Blog</a> for expert tips, or try recommended tools like mindfulness apps and online therapy in the footer below. Enhance your experience with premium features coming soon!</p>
            </div>
        </div>
        <div class="footer">
            <div>
                <h3>MoodTask</h3>
                <p>Transform your mood with science-backed activities designed to improve your emotional well-being.</p>
            </div>
            <div>
                <h3>Quick Links</h3>
                <a href="index.html">Home</a>
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Use</a>
            </div>
            <div class="connect">
                <h3>Connect</h3>
                <a href="https://twitter.com/share?url=https://moodtask.org"><i class="fab fa-twitter"></i> Share on Twitter</a>
                <a href="https://www.buymeacoffee.com/moodtask" class="coffee"><i class="fas fa-coffee"></i> Buy Me a Coffee</a>
                <a href="https://www.online-therapy.com/?aff_id=12345" class="therapy">Online Therapy</a>
                <a href="https://www.mindfulness.com/?aff_id=67890" class="mindfulness">Mindfulness</a>
            </div>
            <div class="affiliate-note">
                AFFILIATE DISCLOSURE: Some links on this site are affiliate links. We may earn a commission on purchases at no extra cost to you.<br>
                © 2025 MoodTask. All rights reserved.
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="sleepModal">
        <div class="modal-content">
            <h3>Log Sleep Duration</h3>
            <input type="number" id="sleepInput" placeholder="Enter hours (e.g., 7.5)" step="0.1" min="0" max="24">
            <button class="save-btn" onclick="saveSleep()">Save</button>
            <button class="cancel-btn" onclick="closeModal('sleepModal')">Cancel</button>
            <p class="recommendation">Good reminder: Aim for 7-8 hours per night (Dr. Matt Walker).</p>
        </div>
    </div>
    <div class="modal" id="waterModal">
        <div class="modal-content">
            <h3>Log Water Intake</h3>
            <input type="number" id="waterInput" placeholder="Enter amount" min="0">
            <select id="waterUnit">
                <option value="oz">oz</option>
                <option value="ml">ml</option>
            </select>
            <button class="save-btn" onclick="saveWater()">Save</button>
            <button class="cancel-btn" onclick="closeModal('waterModal')">Cancel</button>
            <a href="https://amzn.to/42jEfjN" class="affiliate-link" target="_blank">Stay hydrated with Echo Go+ (affiliate link)</a>
            <p class="recommendation">Recommended: 64-80 oz (8-10 cups) daily for adults (general guideline).</p>
        </div>
    </div>
    <div class="modal" id="exerciseModal">
        <div class="modal-content">
            <h3>Log Exercise</h3>
            <input type="text" id="exerciseDuration" placeholder="Duration (e.g., 30 min)">
            <input type="text" id="exerciseType" placeholder="Type (e.g., Running)">
            <button class="save-btn" onclick="saveExercise()">Save</button>
            <button class="cancel-btn" onclick="closeModal('exerciseModal')">Cancel</button>
            <p class="recommendation">Dr. Andrew Huberman suggests 150-200 min/week (~20-30 min/day).</p>
        </div>
    </div>

    <script>
        function adjustMainContentPadding() {
            const navBar = document.querySelector('.nav-bar');
            const mainContent = document.querySelector('.main-content');
            if (navBar && mainContent) {
                const navHeight = navBar.offsetHeight;
                mainContent.style.paddingTop = `${navHeight + 10}px`;
            }
        }

        function toggleNavMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            if (modalId === 'sleepModal') {
                document.getElementById('sleepInput').value = '';
            } else if (modalId === 'waterModal') {
                document.getElementById('waterInput').value = '';
                document.getElementById('waterUnit').value = 'oz';
            } else if (modalId === 'exerciseModal') {
                document.getElementById('exerciseDuration').value = '';
                document.getElementById('exerciseType').value = '';
            }
        }

        function saveSleep() {
            const sleepInput = parseFloat(document.getElementById('sleepInput').value);
            const today = new Date('2025-05-01').toISOString().split('T')[0];
            if (!isNaN(sleepInput) && sleepInput > 0) {
                let totalSleep = 0;
                const sleepHistory = JSON.parse(localStorage.getItem('sleep-history') || '{}');
                if (sleepHistory[today]) {
                    totalSleep = parseFloat(sleepHistory[today].split(' ')[0]) + sleepInput;
                    if (totalSleep > 24) totalSleep = 24;
                } else {
                    totalSleep = sleepInput > 24 ? 24 : sleepInput;
                }
                sleepHistory[today] = `${totalSleep} hours`;
                localStorage.setItem('sleep-history', JSON.stringify(sleepHistory));
                localStorage.setItem(`sleep-${today}`, `${totalSleep} hours`);
                updateTrackingCards();
                drawGraph();
            }
            closeModal('sleepModal');
        }

        function saveWater() {
            const waterInput = parseFloat(document.getElementById('waterInput').value);
            const waterUnit = document.getElementById('waterUnit').value;
            const today = new Date('2025-05-01').toISOString().split('T')[0];
            if (!isNaN(waterInput) && waterInput > 0) {
                let amountInOz = waterUnit === 'ml' ? (waterInput / 29.5735).toFixed(1) : waterInput;
                let amountInMl = waterUnit === 'oz' ? (waterInput * 29.5735).toFixed(1) : waterInput;

                let totalOz = 0, totalMl = 0;
                const waterHistory = JSON.parse(localStorage.getItem('water-history') || '{}');
                if (waterHistory[today]) {
                    const [prevOz, prevMl] = waterHistory[today].match(/\d+\.\d+|\d+/g);
                    totalOz = parseFloat(prevOz) + parseFloat(amountInOz);
                    totalMl = parseFloat(prevMl) + parseFloat(amountInMl);
                } else {
                    totalOz = parseFloat(amountInOz);
                    totalMl = parseFloat(amountInMl);
                }
                waterHistory[today] = `${totalOz.toFixed(1)} oz (${totalMl.toFixed(1)} ml)`;
                localStorage.setItem('water-history', JSON.stringify(waterHistory));
                localStorage.setItem(`water-${today}`, `${totalOz.toFixed(1)} oz (${totalMl.toFixed(1)} ml)`);
                updateTrackingCards();
                drawGraph();
            }
            closeModal('waterModal');
        }

        function saveExercise() {
            const duration = document.getElementById('exerciseDuration').value.trim();
            const type = document.getElementById('exerciseType').value.trim();
            const today = new Date('2025-05-01').toISOString().split('T')[0];
            if (duration && type) {
                let exerciseHistory = JSON.parse(localStorage.getItem('exercise-history') || '[]');
                const durationMatch = duration.match(/(\d+)/);
                const minutes = durationMatch ? parseInt(durationMatch[0]) : 0;
                exerciseHistory.push({ date: today, duration, type, minutes });
                localStorage.setItem('exercise-history', JSON.stringify(exerciseHistory));

                const uniqueDays = new Set(exerciseHistory.map(entry => entry.date));
                document.getElementById('exerciseDays').textContent = `Days exercised: ${uniqueDays.size}`;

                let currentDayExercises = exerciseHistory.filter(entry => entry.date === today)
                    .map(entry => `${entry.duration} - ${entry.type}`).join(', ');
                localStorage.setItem(`exercise-${today}`, currentDayExercises || 'Not logged.');
                updateTrackingCards();
                drawGraph();
            }
            closeModal('exerciseModal');
        }

        function resetDailyTrackers() {
            const now = new Date('2025-05-01');
            const lastReset = localStorage.getItem('lastReset') ? new Date(localStorage.getItem('lastReset')) : null;
            if (!lastReset || now.getDate() !== lastReset.getDate()) {
                const today = now.toISOString().split('T')[0];
                const sleepHistory = JSON.parse(localStorage.getItem('sleep-history') || '{}');
                const waterHistory = JSON.parse(localStorage.getItem('water-history') || '{}');
                const exerciseHistory = JSON.parse(localStorage.getItem('exercise-history') || '[]');

                delete sleepHistory[today];
                delete waterHistory[today];
                exerciseHistory.forEach((entry, index) => {
                    if (entry.date === today) exerciseHistory.splice(index, 1);
                });
                localStorage.setItem('sleep-history', JSON.stringify(sleepHistory));
                localStorage.setItem('water-history', JSON.stringify(waterHistory));
                localStorage.setItem('exercise-history', JSON.stringify(exerciseHistory));

                localStorage.setItem('lastReset', now.toISOString());
                updateTrackingCards();
                drawGraph();
            }
        }

        function drawGraph() {
            const canvas = document.getElementById('progressGraph');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const metric = document.getElementById('metricSelect').value;
            const period = document.getElementById('periodSelect').value;
            const now = new Date('2025-05-01');
            let startDate = new Date(now);
            let dates = [];

            if (period === '7') {
                startDate.setDate(now.getDate() - 6);
                while (startDate.getDay() !== 0) startDate.setDate(startDate.getDate() - 1);
                for (let d = new Date(startDate); d <= now; d.setDate(d.getDate() + 1)) {
                    dates.push(new Date(d));
                }
            } else if (period === '30') {
                startDate.setDate(now.getDate() - 29);
                while (startDate.getDay() !== 0) startDate.setDate(startDate.getDate() - 1);
                for (let d = new Date(startDate); d <= now; d.setDate(d.getDate() + 1)) {
                    dates.push(new Date(d));
                }
            } else if (period === 'week') {
                startDate.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1));
                for (let d = new Date(startDate); d <= now; d.setDate(d.getDate() + 1)) {
                    dates.push(new Date(d));
                }
            } else if (period === 'month') {
                startDate.setDate(1);
                for (let d = new Date(startDate); d <= now; d.setDate(d.getDate() + 1)) {
                    dates.push(new Date(d));
                }
            } else if (period === 'all') {
                const allDates = Object.keys({
                    ...JSON.parse(localStorage.getItem('sleep-history') || '{}'),
                    ...JSON.parse(localStorage.getItem('water-history') || '{}'),
                    ...Object.fromEntries(JSON.parse(localStorage.getItem('exercise-history') || '[]').map(e => [e.date, true]))
                }).map(d => new Date(d));
                dates = allDates.sort((a, b) => a - b);
                if (dates.length === 0) dates = [new Date(now)];
            }

            const sleepHistory = JSON.parse(localStorage.getItem('sleep-history') || '{}');
            const waterHistory = JSON.parse(localStorage.getItem('water-history') || '{}');
            const exerciseHistory = JSON.parse(localStorage.getItem('exercise-history') || '[]');
            const moodHistory = JSON.parse(localStorage.getItem('mood-history') || '{}');

            let data = [];
            if (metric === 'sleep') {
                data = dates.map(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    return sleepHistory[dateStr] ? parseFloat(sleepHistory[dateStr].split(' ')[0]) : 0;
                });
            } else if (metric === 'water') {
                data = dates.map(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    return waterHistory[dateStr] ? parseFloat(waterHistory[dateStr].match(/\d+\.\d+|\d+/)[0]) : 0;
                });
            } else if (metric === 'exercise') {
                data = dates.map(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    const dayExercises = exerciseHistory.filter(e => e.date === dateStr);
                    return dayExercises.reduce((sum, e) => sum + (e.minutes || 0), 0);
                });
            }

            const maxValue = Math.max(...data, 10) || 10; // Minimum 10 for scaling
            const barWidth = Math.min(40, (canvas.width - 40) / dates.length - 10);
            const barSpacing = 10;
            const barHeight = (canvas.height - 100) / maxValue;

            // Grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= maxValue; i += 5) {
                const y = canvas.height - 50 - (i * barHeight);
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
                ctx.fillStyle = '#666';
                ctx.font = '12px Poppins';
                ctx.fillText(i, 5, y - 5);
            }

            // Bars
            ctx.lineWidth = 1;
            data.forEach((value, index) => {
                const x = index * (barWidth + barSpacing);
                const height = value * barHeight;
                let gradient;
                if (metric === 'sleep') gradient = ctx.createLinearGradient(x, canvas.height - 50, x, canvas.height - 50 - height);
                else if (metric === 'water') gradient = ctx.createLinearGradient(x, canvas.height - 50, x, canvas.height - 50 - height);
                else gradient = ctx.createLinearGradient(x, canvas.height - 50, x, canvas.height - 50 - height);
                gradient.addColorStop(0, metric === 'sleep' ? '#4A90E2' : metric === 'water' ? '#6BCB77' : '#E74C3C');
                gradient.addColorStop(1, metric === 'sleep' ? '#85C1E9' : metric === 'water' ? '#A9DFBF' : '#F1948A');
                ctx.fillStyle = gradient;
                ctx.fillRect(x, canvas.height - 50 - height, barWidth, height);
                ctx.fillStyle = '#333';
                ctx.font = '12px Poppins';
                ctx.textAlign = 'center';
                if (metric === 'exercise') {
                    ctx.fillText(`Total: ${value} min`, x + barWidth / 2, canvas.height - 60 - height);
                } else {
                    ctx.fillText(value.toFixed(1), x + barWidth / 2, canvas.height - 60 - height);
                }
                const dateStr = dates[index].toISOString().split('T')[0];
                if (moodHistory[dateStr]) {
                    const moodIcon = getMoodIcon(moodHistory[dateStr]);
                    ctx.fillText(moodIcon, x + barWidth / 2, canvas.height - 40);
                }
                ctx.fillText(dates[index].toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' }), x + barWidth / 2, canvas.height - 20);
            });

            // Legend
            ctx.fillStyle = '#4A90E2';
            ctx.fillRect(10, 10, 20, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Sleep', 35, 18);
            ctx.fillStyle = '#6BCB77';
            ctx.fillRect(90, 10, 20, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Water', 115, 18);
            ctx.fillStyle = '#E74C3C';
            ctx.fillRect(170, 10, 20, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Exercise', 195, 18);
        }

        function getMoodIcon(mood) {
            const moodIcons = {
                Sad: '😔',
                Angry: '😠',
                Frustrated: '😣',
                Anxious: '😰',
                Stressed: '😓',
                Tired: '😴',
                Bored: '😐',
                Excited: '😃',
                Relaxed: '😌',
                Happy: '😊'
            };
            return moodIcons[mood] || '';
        }

        function updateTrackingCards() {
            const today = new Date('2025-05-01').toISOString().split('T')[0];
            document.getElementById('lastMusic').textContent = localStorage.getItem(`music-last-${today}`) || 'Not listened yet.';
            document.getElementById('firstActivity').textContent = localStorage.getItem(`activity-first-${today}`) || 'None today.';
            document.getElementById('sleepDuration').textContent = localStorage.getItem(`sleep-${today}`) || 'Not logged.';
            document.getElementById('waterIntake').textContent = localStorage.getItem(`water-${today}`) || '0 oz (0 ml)';
            const exerciseHistory = JSON.parse(localStorage.getItem('exercise-history') || '[]');
            const currentDayExercises = exerciseHistory.filter(entry => entry.date === today)
                .map(entry => `${entry.duration} - ${entry.type}`).join(', ');
            document.getElementById('exerciseDetails').textContent = currentDayExercises || 'Not logged.';
            const uniqueDays = new Set(exerciseHistory.map(entry => entry.date));
            document.getElementById('exerciseDays').textContent = `Days exercised: ${uniqueDays.size}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-bar .nav-links a');
            const mainContent = document.querySelector('.main-content');
            const hamburger = document.getElementById('hamburger');

            if (!mainContent) return;

            mainContent.classList.add('fade-in');
            adjustMainContentPadding();
            resetDailyTrackers();
            updateTrackingCards();
            drawGraph();

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    mainContent.classList.remove('fade-in');
                    mainContent.classList.add('fade-out');
                    setTimeout(() => {
                        window.location.href = link.href;
                    }, 500);
                });
            });

            if (hamburger) {
                hamburger.addEventListener('click', toggleNavMenu);
            }

            window.addEventListener('resize', () => {
                adjustMainContentPadding();
                drawGraph();
            });
        });
    </script>
</body>
</html>
